/**
 * jQuery.rating - 5 star rating plugin
 * Copyright (c) Ennexa Technologies (P) Ltd | http://www.ennexa.com/
 * Dual licensed under MIT and GPL.
 * @version 2.0.0
 */
/*! http://git.io/rating | © Ennexa Technologies | http://www.ennexa.com/ */
!function(e,n){"use strict"
function r(n,r){var t=r.options,a=t.id,s=t.value
t.xhr&&t.xhr.abort(),setTimeout(function(){var o=a.match(/(.*)-(\d+)/)
t.xhr=e.post(t.url,{item_section:o[1],item_id:o[2],rating_value:s},function(o){"OK"===o.status?(e.cookie("rating."+a,s,e.extend({path:null,expires:30},t.cookie)),r.options.rated=!0,e(n.target).rating("refresh")):e.error(o.message)})},500)}function t(n,r){var t=r.options,a=e.cookie("rating."+t.id)
a&&(t.value=parseInt(a,10),t.rated=!0)}var a="com.ennexa.rating",s=function(e,n){this.init(e,n)}
e.extend(s,{defaults:{id:null,rated:!1,value:null,url:"/api/rating.json",change:r,init:t,emptyClass:"icon icon-star-o",fillClass:"icon icon-star",hoverClass:"icon icon-star",activeClass:"icon icon-star"},ns:function(){return a},prototype:{init:function(n,r){var t,s=this
this.$elem=t=e(n).prop("type","hidden"),r.id=r.id||n.id||"",r.value=parseInt(r.value,10)||parseInt(t.val(),10),r.id&&!isNaN(r.value)&&(this.options=r,this.$wrapper=e('<span class="star-rating"><a/><a/><a/><a/><a/></span>').insertBefore(t),this.$wrapper.children().prop("href","#").addClass("star-rating-star").append("★"),t.on("change."+a,function(){s.update(s.$elem.val())}),this.$wrapper.on("click touchstart",".star-rating-star",function(n){n.stopPropagation(),n.preventDefault(),t.val(e(this).index()+1).trigger("change."+a)}).on("mouseenter",".star-rating-star",function(){s.fill(e(this).index()+1,!0)}).on("mouseleave",function(){s.fill(s.$elem.val(),!1)}),t.on("ratinginit."+a,r.init).on("ratingchange."+a,r.change).trigger("ratinginit."+a,{options:r}),this.fill(r.value))},refresh:function(e){this.fill(this.options.value=this.$elem.val())},update:function(e){var n=this.options.value
this.fill(e,!1),this.options.value=e,this.$elem.trigger("ratingchange."+a,{oldValue:n,options:this.options})},fill:function(e,n){var r=this.options,t=Math.round(e)-1,a=n?"hover":r.rated?"active":"fill",s=this.$wrapper.removeClass("rating-hover rating-active rating-fill").addClass("rating-"+a).children()
s.removeClass([r.hoverClass,r.fillClass,r.activeClass].join(" ")).addClass(r.emptyClass),s.eq(t).prevAll(".star-rating-star").addBack().removeClass(r.emptyClass).addClass(r[a+"Class"])}}})
var o=function(n){return this.each(function(){var r=e(this),t=r.data(a),o=e.extend({},s.defaults,r.data(),"object"==typeof n&&n)
t||r.data(a,t=new s(this,o)),"string"==typeof n&&t[n].call(t,Array.prototype.slice.call(arguments,1))})}
e.fn.rating=o,e(function(){e("input.star-rating").rating()})}(jQuery)
